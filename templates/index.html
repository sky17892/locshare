<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>위치 공유 세션 생성</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/site.css') }}" />
  </head>
  <body class="page page--split">
    <main class="card card--hero">
      <section class="hero-copy">
        <p class="badge">실시간 위치 공유</p>
        <h1><span>사랑하는 사람들</span>과 지금 어디 있는지 확인하세요</h1>
        <p class="subtitle">
          링크를 보내 동의만 받으면, 실시간 위치가 관리자 페이지에 안전하게 저장됩니다.
        </p>
        <div class="actions">
          <button id="create-session-btn" class="btn btn-primary btn-lg">새 세션 만들기</button>
          <!--<p class="hint">URL을 복사해 상대방에게 전송하세요.</p>-->
        </div>
        <div id="session-result" class="session-result" hidden>
          <label>공유 URL</label>
          <input id="share-url" class="input" readonly />
        </div>
      </section>
      <section class="hero-visual">
        {% include "_phone_preview.html" %}
      </section>
    </main>
    <script>
      const btn = document.getElementById('create-session-btn');
      const result = document.getElementById('session-result');
      const shareInput = document.getElementById('share-url');

      btn.addEventListener('click', async () => {
        btn.disabled = true;
        btn.textContent = '발급 중...';
        try {
          const resp = await fetch('/api/session', { method: 'POST' });
          if (!resp.ok) {
            throw new Error('세션 생성 실패');
          }
          const data = await resp.json();
          shareInput.value = data.share_url;
          result.hidden = false;
        } catch (err) {
          alert(err.message);
        } finally {
          btn.disabled = false;
          btn.textContent = '새 세션 만들기';
        }
      });
    </script>
  </body>
</html>

